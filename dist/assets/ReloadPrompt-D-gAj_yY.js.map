{"version":3,"mappings":"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","names":["registerSW","options","immediate","onNeedRefresh","onOfflineReady","onRegistered","onRegisteredSW","onRegisterError","wb","registerPromise","sendSkipWaitingMessage","updateServiceWorker","_reloadPage","register","__vitePreload","Workbox","e","onNeedRefreshCalled","showSkipWaitingPrompt","event","r","useRegisterSW","needRefresh","setNeedRefresh","useState","offlineReady","setOfflineReady","pwaInfo","ReloadPrompt","buildDate","swUrl","error","close","jsxs","jsx"],"sources":["../../../../../../../@vite-plugin-pwa/virtual:pwa-register/react","../../src/ReloadPrompt.tsx"],"sourcesContent":["// src/client/build/react.ts\nimport { useState } from \"react\";\n\n// src/client/build/register.ts\nvar autoUpdateMode = \"false\";\nvar selfDestroying = \"false\";\nvar auto = autoUpdateMode === \"true\";\nvar autoDestroy = selfDestroying === \"true\";\nfunction registerSW(options = {}) {\n  const {\n    immediate = false,\n    onNeedRefresh,\n    onOfflineReady,\n    onRegistered,\n    onRegisteredSW,\n    onRegisterError\n  } = options;\n  let wb;\n  let registerPromise;\n  let sendSkipWaitingMessage;\n  const updateServiceWorker = async (_reloadPage = true) => {\n    await registerPromise;\n    if (!auto) {\n      sendSkipWaitingMessage?.();\n    }\n  };\n  async function register() {\n    if (\"serviceWorker\" in navigator) {\n      wb = await import(\"workbox-window\").then(({ Workbox }) => {\n        return new Workbox(\"/sw.js\", { scope: \"/\", type: \"classic\" });\n      }).catch((e) => {\n        onRegisterError?.(e);\n        return void 0;\n      });\n      if (!wb)\n        return;\n      sendSkipWaitingMessage = () => {\n        wb?.messageSkipWaiting();\n      };\n      if (!autoDestroy) {\n        if (auto) {\n          wb.addEventListener(\"activated\", (event) => {\n            if (event.isUpdate || event.isExternal)\n              window.location.reload();\n          });\n          wb.addEventListener(\"installed\", (event) => {\n            if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n        } else {\n          let onNeedRefreshCalled = false;\n          const showSkipWaitingPrompt = () => {\n            onNeedRefreshCalled = true;\n            wb?.addEventListener(\"controlling\", (event) => {\n              if (event.isUpdate)\n                window.location.reload();\n            });\n            onNeedRefresh?.();\n          };\n          wb.addEventListener(\"installed\", (event) => {\n            if (typeof event.isUpdate === \"undefined\") {\n              if (typeof event.isExternal !== \"undefined\") {\n                if (event.isExternal)\n                  showSkipWaitingPrompt();\n                else\n                  !onNeedRefreshCalled && onOfflineReady?.();\n              } else {\n                !onNeedRefreshCalled && onOfflineReady?.();\n              }\n            } else if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n          wb.addEventListener(\"waiting\", showSkipWaitingPrompt);\n        }\n      }\n      wb.register({ immediate }).then((r) => {\n        if (onRegisteredSW)\n          onRegisteredSW(\"/sw.js\", r);\n        else\n          onRegistered?.(r);\n      }).catch((e) => {\n        onRegisterError?.(e);\n      });\n    }\n  }\n  registerPromise = register();\n  return updateServiceWorker;\n}\n\n// src/client/build/react.ts\nfunction useRegisterSW(options = {}) {\n  const {\n    immediate = true,\n    onNeedRefresh,\n    onOfflineReady,\n    onRegistered,\n    onRegisteredSW,\n    onRegisterError\n  } = options;\n  const [needRefresh, setNeedRefresh] = useState(false);\n  const [offlineReady, setOfflineReady] = useState(false);\n  const [updateServiceWorker] = useState(() => {\n    return registerSW({\n      immediate,\n      onOfflineReady() {\n        setOfflineReady(true);\n        onOfflineReady?.();\n      },\n      onNeedRefresh() {\n        setNeedRefresh(true);\n        onNeedRefresh?.();\n      },\n      onRegistered,\n      onRegisteredSW,\n      onRegisterError\n    });\n  });\n  return {\n    needRefresh: [needRefresh, setNeedRefresh],\n    offlineReady: [offlineReady, setOfflineReady],\n    updateServiceWorker\n  };\n}\nexport {\n  useRegisterSW\n};\n","import React from \"react\"\nimport { pwaInfo } from \"virtual:pwa-info\"\nimport { useRegisterSW } from \"virtual:pwa-register/react\"\nimport './ReloadPrompt.css'\n\nconsole.log(pwaInfo)\n\nfunction ReloadPrompt() {\n  // replaced dynamically\n  const buildDate = '__DATE__'\n  // replaced dyanmicaly\n  const reloadSW = '__RELOAD_SW__'\n\n  const {\n    offlineReady: [offlineReady, setOfflineReady],\n    needRefresh: [needRefresh, setNeedRefresh],\n    updateServiceWorker,\n  } = useRegisterSW({\n    onRegisteredSW(swUrl, r) {\n      console.log(`Service Worker at: ${swUrl}`)\n      // @ts-expect-error just ignore\n      if (reloadSW === 'true') {\n        r && setInterval(() => {\n          console.log('Checking for sw update')\n          r.update()\n        }, 20000 /* 20s for testing purposes */)\n      }\n      else {\n        // eslint-disable-next-line prefer-template\n        console.log('SW Registered: ' + r)\n      }\n    },\n    onRegisterError(error) {\n      console.log('SW registration error', error)\n    },\n  })\n\n  const close = () => {\n    setOfflineReady(false)\n    setNeedRefresh(false)\n  }\n\n  return (\n    <div className=\"ReloadPrompt-container\">\n      { (offlineReady || needRefresh)\n        && (\n          <div className=\"ReloadPrompt-toast\">\n            <div className=\"ReloadPrompt-toast-message\">\n              { offlineReady\n                ? <span>App ready to work offline</span>\n                : <span>New content available, click on reload button to update.</span>}\n            </div>\n            { needRefresh && <button className=\"ReloadPrompt-toast-button\" onClick={() => updateServiceWorker()}>Reload</button> }\n            <button className=\"ReloadPrompt-toast-button\" onClick={() => close()}>Close</button>\n          </div>\n        )}\n      <div className=\"ReloadPrompt-date\">{buildDate}</div>\n    </div>\n  )\n}\n\nexport default ReloadPrompt\n\n"],"file":"assets/ReloadPrompt-D-gAj_yY.js"}